<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>一路小跑</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://jkyeo.com/"/>
  <updated>2016-07-10T15:09:16.000Z</updated>
  <id>http://jkyeo.com/</id>
  
  <author>
    <name>jk.yeo</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SplashView - 一行代码解决闪屏页(广告页) - iOS(Swift) 篇</title>
    <link href="http://jkyeo.com/2016/07/10/SplashView-%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E8%A7%A3%E5%86%B3%E9%97%AA%E5%B1%8F%E9%A1%B5-%E5%B9%BF%E5%91%8A%E9%A1%B5-iOS-Swift-%E7%AF%87/"/>
    <id>http://jkyeo.com/2016/07/10/SplashView-一行代码解决闪屏页-广告页-iOS-Swift-篇/</id>
    <published>2016-07-10T13:30:57.000Z</published>
    <updated>2016-07-10T15:09:16.000Z</updated>
    
    <content type="html">&lt;p&gt;关于 SplashView 详细接受可以参考 Android 版: &lt;a href=&quot;/2016/07/10/SplashView-一行代码解决闪屏页-广告页-Android-篇/&quot;&gt;SplashView-一行代码解决闪屏页-广告页-Android-篇&lt;/a&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;iOS 效果：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ww3.sinaimg.cn/large/006tNc79gw1f5p7bukwkhg30b00k0b29.gif&quot; alt=&quot;splash_default_ios.mov.gif&quot;&gt; &lt;img src=&quot;http://ww3.sinaimg.cn/large/006tNc79gw1f5p7bp26p0g30aw0k0hdw.gif&quot; alt=&quot;splash_view_ios.mov.gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;显示 SplashView 静态方法:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;simpleShowSplashView&lt;/span&gt;()&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;也可以自定义超时时间、默认 Image、回到 Block：&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;showSplashView&lt;/span&gt;(&lt;span class=&quot;title&quot;&gt;duration&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;Int&lt;/span&gt; = 6,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                              &lt;span class=&quot;title&quot;&gt;defaultImage&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;UIImage&lt;/span&gt;?,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                              &lt;span class=&quot;title&quot;&gt;tapSplashImageBlock&lt;/span&gt;: ((&lt;span class=&quot;title&quot;&gt;actionUrl&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;String&lt;/span&gt;?) -&amp;gt; &lt;span class=&quot;title&quot;&gt;Void&lt;/span&gt;)?,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                              &lt;span class=&quot;title&quot;&gt;splashViewDismissBlock&lt;/span&gt;: ((&lt;span class=&quot;title&quot;&gt;initiativeDismiss&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;Bool&lt;/span&gt;) -&amp;gt; &lt;span class=&quot;title&quot;&gt;Void&lt;/span&gt;)?)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;div class=&quot;tip&quot;&gt; 需要注意的是：以上两个方法都需要至少在 UIViewController 的 View 显示之后 (即: override func viewDidAppear(animated: Bool)) 再调用才能达到显示 SplashView 的效果。&lt;/div&gt;

&lt;p&gt;可以在任何地方更新 SplashView data:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;updateSplashData&lt;/span&gt;(&lt;span class=&quot;title&quot;&gt;imgUrl&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;String&lt;/span&gt;?, &lt;span class=&quot;title&quot;&gt;actUrl&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;String&lt;/span&gt;?)&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;完整示例代码参见: &lt;a href=&quot;https://github.com/jkyeo/iOS-SplashView&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jkyeo/iOS-SplashView&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;关于 SplashView 详细接受可以参考 Android 版: &lt;a href=&quot;/2016/07/10/SplashView-一行代码解决闪屏页-广告页-Android-篇/&quot;&gt;SplashView-一行代码解决闪屏页-广告页-Android-篇&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>SplashView - 一行代码解决闪屏页(广告页) - Android 篇</title>
    <link href="http://jkyeo.com/2016/07/10/SplashView-%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E8%A7%A3%E5%86%B3%E9%97%AA%E5%B1%8F%E9%A1%B5-%E5%B9%BF%E5%91%8A%E9%A1%B5-Android-%E7%AF%87/"/>
    <id>http://jkyeo.com/2016/07/10/SplashView-一行代码解决闪屏页-广告页-Android-篇/</id>
    <published>2016-07-10T12:19:22.000Z</published>
    <updated>2016-07-10T13:32:20.000Z</updated>
    
    <content type="html">&lt;p&gt;闪屏页或者广告页 (SplashView) 在众多 App 里是比较常见的。一般来说 SplashView 有以下职责：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在合适的时机显示 SplashView - 可控性&lt;/li&gt;
&lt;li&gt;下载、缓存、更新图片&lt;/li&gt;
&lt;li&gt;回调响应图片点击事件&lt;/li&gt;
&lt;li&gt;倒计时 Dismiss View，主动跳过 Dissmiss View&lt;/li&gt;
&lt;li&gt;本地没有缓存时，显示默认图片或者不显示 SplashView&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;好了，先看看效果：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ww4.sinaimg.cn/large/006tNc79gw1f5p3fx3mlwg315o0nfgzr.gif&quot; alt=&quot;geminiMXB48Tjkyeo07102016200452.mp4.gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ww2.sinaimg.cn/large/006tNbRwgw1f5p2r46gzug315o0nfkjm.gif&quot; alt=&quot;geminiMXB48Tjkyeo07102016200339.mp4.gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;在 Activity 上显示 SplashView， 需要注意的是要在 Activity setContentView(int viewId) 之后调用:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        setContentView(R.layout.activity_sample);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// call after setContentView(R.layout.activity_sample);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        SplashView.simpleShowSplashView(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;也可以自定义超时时间、默认图片、回调方法等：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * static method, show splashView on above of the activity&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * you should called after setContentView()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; activity  activity instance&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; durationTime  time to countDown&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; defaultBitmapRes  if there&#39;s no cached bitmap, show this default bitmap;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     *                          if null == defaultBitmapRes, then will not show the splashView&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * &lt;span class=&quot;doctag&quot;&gt;@param&lt;/span&gt; listener  splash view listener contains onImageClick and onDismiss&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;SplashView.showSplashView(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, R.drawable.default_img, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SplashView.OnSplashViewActionListener() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onSplashImageClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String actionUrl)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                Log.d(&lt;span class=&quot;string&quot;&gt;&quot;SplashView&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;img clicked. actionUrl: &quot;&lt;/span&gt; + actionUrl);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                Toast.makeText(SampleActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;img clicked.&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onSplashViewDismiss&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; initiativeDismiss)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                Log.d(&lt;span class=&quot;string&quot;&gt;&quot;SplashView&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;dismissed, initiativeDismiss: &quot;&lt;/span&gt; + initiativeDismiss);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;更新 SplashView 数据方法 updateSplashData 可以在任何时候任何地方调用：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// call this method anywhere to update splash view data&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;SplashView.updateSplashData(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;http://ww2.sinaimg.cn/large/72f96cbagw1f5mxjtl6htj20g00sg0vn.jpg&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;http://jkyeo.com&quot;&lt;/span&gt;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;说说原理，其实很简单。如图选中 FrameLayout 下唯一的 ChildView 是我们自定义的通过 setContentView 设置的 View。那么我们只需要讲 SplashView 作为这个 FrameLayout 的 ChildView 覆盖在最上层即可。合适的时候 remove 实现 Dismiss。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ww1.sinaimg.cn/large/006tNc79gw1f5p4jjodf5j31i610kk3c.jpg&quot; alt=&quot;QQ20160710-0@2x.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;核心代码：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;ViewGroup contentView = (ViewGroup) activity.getWindow().getDecorView().findViewById(android.R.id.content);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;contentView.addView(splashView, param);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;剩下的就是处理缓存、定时器、Dismiss 动画、显示隐藏状态栏，ActionBar 的问题了。&lt;/p&gt;
&lt;p&gt;对应 iOS(Swift) 版本在这里: &lt;a href=&quot;/2016/07/10/SplashView-一行代码解决闪屏页-广告页-iOS-Swift-篇/&quot;&gt;SplashView-一行代码解决闪屏页-广告页-iOS-Swift-篇&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;完整示例代码参见: &lt;a href=&quot;https://github.com/jkyeo/Android-SplashView&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jkyeo/Android-SplashView&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;闪屏页或者广告页 (SplashView) 在众多 App 里是比较常见的。一般来说 SplashView 有以下职责：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在合适的时机显示 SplashView - 可控性&lt;/li&gt;
&lt;li&gt;下载、缓存、更新图片&lt;/li&gt;
&lt;li&gt;回调响应图片点击事件&lt;/li&gt;
&lt;li&gt;倒计时 Dismiss View，主动跳过 Dissmiss View&lt;/li&gt;
&lt;li&gt;本地没有缓存时，显示默认图片或者不显示 SplashView&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="android" scheme="http://jkyeo.com/tags/android/"/>
    
      <category term="view" scheme="http://jkyeo.com/tags/view/"/>
    
  </entry>
  
  <entry>
    <title>学习 Swift Moya（二）- Moya + SwiftyJSON + RxSwift</title>
    <link href="http://jkyeo.com/2016/06/29/%E5%AD%A6%E4%B9%A0-Swift-Moya%EF%BC%88%E4%BA%8C%EF%BC%89-Moya-SwiftyJSON-RxSwift/"/>
    <id>http://jkyeo.com/2016/06/29/学习-Swift-Moya（二）-Moya-SwiftyJSON-RxSwift/</id>
    <published>2016-06-29T13:23:25.000Z</published>
    <updated>2016-07-01T09:26:17.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;Moya_+_RxSwift&quot;&gt;&lt;a href=&quot;#Moya_+_RxSwift&quot; class=&quot;headerlink&quot; title=&quot;Moya + RxSwift&quot;&gt;&lt;/a&gt;Moya + RxSwift&lt;/h2&gt;&lt;p&gt;Moya + RxSwift 最简单的使用方法是这样的：&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;provider = &lt;span class=&quot;type&quot;&gt;RxMoyaProvider&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;ApiService&lt;/span&gt;&amp;gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;provider.request(&lt;span class=&quot;type&quot;&gt;ApiService&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;Function&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;param&quot;&lt;/span&gt;)).subscribe &amp;#123; (event) -&amp;gt; &lt;span class=&quot;type&quot;&gt;Void&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; event &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; .&lt;span class=&quot;type&quot;&gt;Next&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; response):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// do something like refresh ui&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; .&lt;span class=&quot;type&quot;&gt;Error&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; error):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(error)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Object_Mapper&quot;&gt;&lt;a href=&quot;#Object_Mapper&quot; class=&quot;headerlink&quot; title=&quot;Object Mapper&quot;&gt;&lt;/a&gt;Object Mapper&lt;/h2&gt;&lt;p&gt;结合 Object Mapper 可以很方便的将 Moya.Response  转换成对象输出。Moya 官方也给出了几个典型的 ObjectMapper Extension :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ivanbruel/Moya-ObjectMapper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Moya-ObjectMapper&lt;/a&gt; - ObjectMapper bindings for Moya for easier JSON serialization&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/AvdLee/Moya-SwiftyJSONMapper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Moya-SwiftyJSONMapper&lt;/a&gt; - SwiftyJSON bindings for Moya for easier JSON serialization&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/wattson12/Moya-Argo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Moya-Argo&lt;/a&gt; - Argo bindings for Moya for easier JSON serialization&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/sunshinejr/Moya-ModelMapper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Moya-ModelMapper&lt;/a&gt; - ModelMapper bindings for Moya for easier JSON serialization&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/spxrogers/Moya-Gloss&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Moya-Gloss&lt;/a&gt; - Gloss bindings for Moya for easier JSON serialization&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/DroidsOnRoids/Moya-JASON&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Moya-JASON&lt;/a&gt; - JASON bindings for Moya for easier JSON serialization &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;然而前段开发遇到的接口往往是这样的:&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;resultCode&quot;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;resultMsg&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;查询成功!&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;data&quot;&lt;/span&gt;:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;&quot;city&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;北京&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;&quot;temperature&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;8℃~20℃&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;&quot;weather&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;晴转霾&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;或者这样的：&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;resultCode&quot;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;resultMsg&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;查询成功!&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;data&quot;&lt;/span&gt;:[&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;city&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;北京&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;temperature&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;8℃~20℃&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;weather&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;晴转霾&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;city&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;南京&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;temperature&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;12℃~21℃&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;weather&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;晴&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;也就是说，接口想要返回的业务数据外总是“包裹”了一层状态数据来标记这一次业务返回的成功、失败以及失败的原因。&lt;/p&gt;
&lt;p&gt;那么，对 Moya.Response  做 map 处理后直接得到业务对象(也就是 “data” 下的数据，或为 object，或为 array) 岂不是更优雅？类似的问题在 Android 开放中有讨论过:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;/2016/03/01/Retrofit-RxJava-业务状态重定向及分离/&quot;&gt;Retrofit + RxJava 业务状态重定向及分离&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这篇文章就来讨论在 Moya + RxSwift 环境下如何实现这样的 mapper 数据分离&lt;/p&gt;
&lt;h2 id=&quot;Moya_+_RxSwift_+_SwiftyJSON__u4E1A_u52A1_u72B6_u6001_u91CD_u5B9A_u5411_u53CA_u5206_u79BB&quot;&gt;&lt;a href=&quot;#Moya_+_RxSwift_+_SwiftyJSON__u4E1A_u52A1_u72B6_u6001_u91CD_u5B9A_u5411_u53CA_u5206_u79BB&quot; class=&quot;headerlink&quot; title=&quot;Moya + RxSwift + SwiftyJSON 业务状态重定向及分离&quot;&gt;&lt;/a&gt;Moya + RxSwift + SwiftyJSON 业务状态重定向及分离&lt;/h2&gt;&lt;p&gt;首先我们以聚合数据提供的电影票房查询接口为例:&lt;br&gt;对照 Moya Docs，很容易的建立以下 ApiService:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; apiProvider = &lt;span class=&quot;type&quot;&gt;RxMoyaProvider&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;ApiService&lt;/span&gt;&amp;gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ApiService&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;GetRank&lt;/span&gt;(area: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ApiService&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;TargetType&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; baseURL: &lt;span class=&quot;type&quot;&gt;NSURL&lt;/span&gt; &amp;#123;&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSURL&lt;/span&gt;(string: &lt;span class=&quot;string&quot;&gt;&quot;http://v.juhe.cn&quot;&lt;/span&gt;)!&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; path: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; .&lt;span class=&quot;type&quot;&gt;GetRank&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;_&lt;/span&gt;):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;/boxoffice/rank&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; method: &lt;span class=&quot;type&quot;&gt;Moya&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;Method&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; .&lt;span class=&quot;type&quot;&gt;GET&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; parameters: [&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;: &lt;span class=&quot;type&quot;&gt;AnyObject&lt;/span&gt;]? &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; .&lt;span class=&quot;type&quot;&gt;GetRank&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; area):&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;area&quot;&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; == area ? &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt; : area!,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// 这里是我的测试 key，理论上是免费的，如果失效，请自行申请替换&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;comment&quot;&gt;// 接口详情地址: https://www.juhe.cn/docs/api/id/44&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;key&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;e8ec41002b1441dc9126d7bbf259b747&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            ]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; sampleData: &lt;span class=&quot;type&quot;&gt;NSData&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;.dataUsingEncoding(&lt;span class=&quot;type&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;)!&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里补充一点，如果想要在每一次请求的 header 或者 params 中插入一些公关参数(如 platform, sys_ver 和 uid 等等)，可以通过自定义 Endpoint Closure 方式实现。类似于 Android Okhttp 中的 Network Intercepor:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; headerFields: &lt;span class=&quot;type&quot;&gt;Dictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;&amp;gt; = [&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;platform&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;iOS&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;sys_ver&quot;&lt;/span&gt;: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;UIDevice&lt;/span&gt;.version())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; appendedParams: &lt;span class=&quot;type&quot;&gt;Dictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;AnyObject&lt;/span&gt;&amp;gt; = [&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;uid&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;123456&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; endpointClosure = &amp;#123; (target: &lt;span class=&quot;type&quot;&gt;ApiService&lt;/span&gt;) -&amp;gt; &lt;span class=&quot;type&quot;&gt;Endpoint&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;ApiService&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; url = target.baseURL.&lt;span class=&quot;type&quot;&gt;URLByAppendingPathComponent&lt;/span&gt;(target.path).absoluteString&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Endpoint&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;URL&lt;/span&gt;: url, sampleResponseClosure: &amp;#123;.&lt;span class=&quot;type&quot;&gt;NetworkResponse&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;, target.sampleData)&amp;#125;, method: target.method, parameters: target.parameters)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        .endpointByAddingParameters(appendedParams)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        .endpointByAddingHTTPHeaderFields(headerFields)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后 apiProvider 的初始化就是这样的:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; apiProvider = &lt;span class=&quot;type&quot;&gt;RxMoyaProvider&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;ApiService&lt;/span&gt;&amp;gt;(endpointClosure: endpointClosure)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;更多的，我们还可以自定义 requestClosure, stubClosure, manager 和 plugins 来实现更多的需求。具体可参见  &lt;a href=&quot;https://github.com/Moya/Moya/tree/master/docs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Moya Docs&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;好了，言归正传。&lt;/p&gt;
&lt;p&gt;分析接口返回的 json 数据:&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;&quot;resultcode&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;200&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;&quot;reason&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;success&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;&quot;result&quot;&lt;/span&gt;: [&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;rid&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;惊天魔盗团2&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;wk&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;2016.6.20 - 2016.6.26（单位：万元）&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;wboxoffice&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;28690&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;tboxoffice&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;28690&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;rid&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;2&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;独立日：卷土重来&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;wk&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;2016.6.20 - 2016.6.26（单位：万元）&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;wboxoffice&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;23924&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;&quot;tboxoffice&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;23924&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  ],&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;&quot;error_code&quot;&lt;/span&gt;: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我们选用 SwiftyJSON 来 map json，创建一个 Protocol:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protocol&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Mapable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;init&lt;/span&gt;?(jsonData:&lt;span class=&quot;type&quot;&gt;JSON&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;建立 BoxofficeModel 模型:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BoxofficeModel&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;Mapable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; rid: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; name: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; wk: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; wboxoffice: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; tboxoffice: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;init&lt;/span&gt;?(jsonData: &lt;span class=&quot;type&quot;&gt;JSON&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.rid = jsonData[&lt;span class=&quot;string&quot;&gt;&quot;rid&quot;&lt;/span&gt;].string&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.name = jsonData[&lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt;].string&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.wk = jsonData[&lt;span class=&quot;string&quot;&gt;&quot;wk&quot;&lt;/span&gt;].string&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.wboxoffice = jsonData[&lt;span class=&quot;string&quot;&gt;&quot;wboxoffice&quot;&lt;/span&gt;].string&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.tboxoffice = jsonData[&lt;span class=&quot;string&quot;&gt;&quot;tboxoffice&quot;&lt;/span&gt;].string&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面就是关键点了，怎样分离业务并且 map to objectArray？Show me the code:&lt;/p&gt;
&lt;p&gt;首先定义集中错误:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ORMError&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;ErrorType&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMNoRepresentor&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMNotSuccessfulHTTP&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMNoData&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMCouldNotMakeObjectError&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMBizError&lt;/span&gt;(resultCode: &lt;span class=&quot;type&quot;&gt;Int&lt;/span&gt;?, resultMsg: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中 ORMBizError(resultCode: Int?, resultMsg: String?) 是业务错误， 是前台与后台约定好如果 resultCode == “200” 表示业务成功，可以去 data 中取数据。其他数值表示失败，resultMsg 告知失败原因，比如“认真失败”、“key 过期”等等。&lt;/p&gt;
&lt;p&gt;接下里，我们对上面的 json 进行处理，既然是使用 RxSwift，map 处理可以是扩展 Observable 方法实现，这样可以在 Rx chain 中调用 map 方法:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ORMError&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;ErrorType&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMNoRepresentor&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMNotSuccessfulHTTP&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMNoData&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMCouldNotMakeObjectError&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMBizError&lt;/span&gt;(resultCode: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?, resultMsg: &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt;?)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BizStatus&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;String&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;BizSuccess&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&quot;200&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;BizError&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protocol&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Mapable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;init&lt;/span&gt;?(jsonData:&lt;span class=&quot;type&quot;&gt;JSON&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;RESULT_CODE&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&quot;resultcode&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;RESULT_MSG&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&quot;reason&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;RESULT_DATA&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&quot;result&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Observable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;resultFromJSON&lt;/span&gt;&amp;lt;T: Mapable&amp;gt;&lt;span class=&quot;params&quot;&gt;(jsonData:JSON, classType: T.&lt;span class=&quot;keyword&quot;&gt;Type&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;? &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;(jsonData: jsonData)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;mapResponseToObjArray&lt;/span&gt;&amp;lt;T: Mapable&amp;gt;&lt;span class=&quot;params&quot;&gt;(type: T.&lt;span class=&quot;keyword&quot;&gt;Type&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;type&quot;&gt;Observable&lt;/span&gt;&amp;lt;[&lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;]&amp;gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;map&lt;/span&gt; &amp;#123; response &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// get Moya.Response&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; response = response &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt;? &lt;span class=&quot;type&quot;&gt;Moya&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;Response&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMNoRepresentor&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// check http status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;guard&lt;/span&gt; ((&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;...&lt;span class=&quot;number&quot;&gt;209&lt;/span&gt;) ~= response.statusCode) &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMNotSuccessfulHTTP&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// unwrap biz json shell&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; json = &lt;span class=&quot;type&quot;&gt;JSON&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;init&lt;/span&gt;(data: response.data)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// check biz status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; code = json[&lt;span class=&quot;type&quot;&gt;RESULT_CODE&lt;/span&gt;].string &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; code == &lt;span class=&quot;type&quot;&gt;BizStatus&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;BizSuccess&lt;/span&gt;.rawValue &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// bizSuccess -&amp;gt; wrap and return biz obj array&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; objects = [&lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;]()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; objectsArrays = json[&lt;span class=&quot;type&quot;&gt;RESULT_DATA&lt;/span&gt;].array&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; array = objectsArrays &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; object &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; array &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; obj = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.resultFromJSON(object, classType:type) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                objects.append(obj)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; objects&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMNoData&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMBizError&lt;/span&gt;(resultCode: json[&lt;span class=&quot;type&quot;&gt;RESULT_CODE&lt;/span&gt;].string, resultMsg: json[&lt;span class=&quot;type&quot;&gt;RESULT_MSG&lt;/span&gt;].string)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMCouldNotMakeObjectError&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;最后在业务层，调用就很方便了:&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; disposeBag = &lt;span class=&quot;type&quot;&gt;DisposeBag&lt;/span&gt;()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;apiProvider.request(&lt;span class=&quot;type&quot;&gt;ApiService&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;GetRank&lt;/span&gt;(area: &lt;span class=&quot;string&quot;&gt;&quot;CN&quot;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .mapResponseToObjArray(&lt;span class=&quot;type&quot;&gt;BoxofficeModel&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .subscribe(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                onNext: &amp;#123; boxofficeModelArray &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                  &lt;span class=&quot;comment&quot;&gt;// do somethong like refresh ui&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                onError: &amp;#123; error &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(error)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            )&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            .addDisposableTo(disposeBag)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果 json data 下的业务数据不是一个 array 而只是一个 object 怎么办呢？其实方法大同小异;&lt;/p&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;mapResponseToObj&lt;/span&gt;&amp;lt;T: Mapable&amp;gt;&lt;span class=&quot;params&quot;&gt;(type: T.&lt;span class=&quot;keyword&quot;&gt;Type&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;type&quot;&gt;Observable&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;T&lt;/span&gt;?&amp;gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;map&lt;/span&gt; &amp;#123; representor &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// get Moya.Response&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; response = representor &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt;? &lt;span class=&quot;type&quot;&gt;Moya&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;Response&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMNoRepresentor&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// check http status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;guard&lt;/span&gt; ((&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;...&lt;span class=&quot;number&quot;&gt;209&lt;/span&gt;) ~= response.statusCode) &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMNotSuccessfulHTTP&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// unwrap biz json shell&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; json = &lt;span class=&quot;type&quot;&gt;JSON&lt;/span&gt;.&lt;span class=&quot;keyword&quot;&gt;init&lt;/span&gt;(data: response.data)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;// check biz status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; code = json[&lt;span class=&quot;type&quot;&gt;RESULT_CODE&lt;/span&gt;].string &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; code == &lt;span class=&quot;type&quot;&gt;BizStatus&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;BizSuccess&lt;/span&gt;.rawValue &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// bizSuccess -&amp;gt; return biz obj&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.resultFromJSON(json[&lt;span class=&quot;type&quot;&gt;RESULT_DATA&lt;/span&gt;], classType:type)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// bizError -&amp;gt; throw biz error&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMBizError&lt;/span&gt;(resultCode: json[&lt;span class=&quot;type&quot;&gt;RESULT_CODE&lt;/span&gt;].string, resultMsg: json[&lt;span class=&quot;type&quot;&gt;RESULT_MSG&lt;/span&gt;].string)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;ORMError&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;ORMCouldNotMakeObjectError&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;好了，到这里任务算是完成了。&lt;/p&gt;
&lt;h2 id=&quot;Demo&quot;&gt;&lt;a href=&quot;#Demo&quot; class=&quot;headerlink&quot; title=&quot;Demo&quot;&gt;&lt;/a&gt;Demo&lt;/h2&gt;&lt;p&gt;本文全部代码可运行示例已开源在 Github, 如果我讲的不够明白或者你有更好的解决方法，欢迎斧正、PR:&lt;br&gt;&lt;a href=&quot;https://github.com/jkyeo/RxMoyaMapperDemo&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jkyeo/RxMoyaMapperDemo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Reference: &lt;a href=&quot;https://github.com/artsy/Emergence/blob/master/Emergence/Contexts/Networking/Observable%2BNetworking.swift&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Observable+Networking&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Moya_+_RxSwift&quot;&gt;&lt;a href=&quot;#Moya_+_RxSwift&quot; class=&quot;headerlink&quot; title=&quot;Moya + RxSwift&quot;&gt;&lt;/a&gt;Moya + RxSwift&lt;/h2&gt;&lt;p&gt;Moya + RxSwift 最简单的使用方
    
    </summary>
    
    
      <category term="swift" scheme="http://jkyeo.com/tags/swift/"/>
    
      <category term="iOS" scheme="http://jkyeo.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>学习 Swift Moya（一）</title>
    <link href="http://jkyeo.com/2016/06/28/%E5%AD%A6%E4%B9%A0-Swift-Moya%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://jkyeo.com/2016/06/28/学习-Swift-Moya（一）/</id>
    <published>2016-06-28T09:40:50.000Z</published>
    <updated>2016-06-28T10:47:46.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;What_is_Moya__uFF1F&quot;&gt;&lt;a href=&quot;#What_is_Moya__uFF1F&quot; class=&quot;headerlink&quot; title=&quot;What is Moya ？&quot;&gt;&lt;/a&gt;What is Moya ？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;So the basic idea of Moya is that we want some network abstraction layer that sufficiently encapsulates actually calling Alamofire directly. It should be simple enough that common things are easy, but comprehensive enough that complicated things are also easy.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Link: &lt;a href=&quot;https://github.com/Moya/Moya&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/Moya/Moya&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Feature&quot;&gt;&lt;a href=&quot;#Feature&quot; class=&quot;headerlink&quot; title=&quot;Feature&quot;&gt;&lt;/a&gt;Feature&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Some awesome features of Moya:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Compile-time checking for correct API endpoint accesses.&lt;/li&gt;
&lt;li&gt;Lets you define a clear usage of different endpoints with associated enum values.&lt;/li&gt;
&lt;li&gt;Treats test stubs as first-class citizens so unit testing is super-easy.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;Components&quot;&gt;&lt;a href=&quot;#Components&quot; class=&quot;headerlink&quot; title=&quot;Components&quot;&gt;&lt;/a&gt;Components&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7xqi9q.com1.z0.glb.clouddn.com/2016-06-28_Moya.png&quot; alt=&quot;2016-06-28_Moya.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Default_Configure&quot;&gt;&lt;a href=&quot;#Default_Configure&quot; class=&quot;headerlink&quot; title=&quot;Default Configure&quot;&gt;&lt;/a&gt;Default Configure&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MoyaProvider Default init&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;init&lt;/span&gt;(endpointClosure: &lt;span class=&quot;type&quot;&gt;EndpointClosure&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;MoyaProvider&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;DefaultEndpointMapping&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    requestClosure: &lt;span class=&quot;type&quot;&gt;RequestClosure&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;MoyaProvider&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;DefaultRequestMapping&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    stubClosure: &lt;span class=&quot;type&quot;&gt;StubClosure&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;MoyaProvider&lt;/span&gt;.&lt;span class=&quot;type&quot;&gt;NeverStub&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    manager: &lt;span class=&quot;type&quot;&gt;Manager&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;MoyaProvider&lt;/span&gt;&amp;lt;&lt;span class=&quot;type&quot;&gt;Target&lt;/span&gt;&amp;gt;.&lt;span class=&quot;type&quot;&gt;DefaultAlamofireManager&lt;/span&gt;(),&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    plugins: [&lt;span class=&quot;type&quot;&gt;PluginType&lt;/span&gt;] = []) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.endpointClosure = endpointClosure&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.requestClosure = requestClosure&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.stubClosure = stubClosure&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.manager = manager&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.plugins = plugins&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Default EndpointClosure&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DefaultEndpointMapping&lt;/span&gt;(&lt;span class=&quot;title&quot;&gt;target&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;Target&lt;/span&gt;) -&amp;gt; &lt;span class=&quot;title&quot;&gt;Endpoint&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;Target&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; url = target.baseURL.&lt;span class=&quot;type&quot;&gt;URLByAppendingPathComponent&lt;/span&gt;(target.path).absoluteString&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;Endpoint&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;URL&lt;/span&gt;: url, sampleResponseClosure: &amp;#123;.&lt;span class=&quot;type&quot;&gt;NetworkResponse&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;, target.sampleData)&amp;#125;, method: target.method, parameters: target.parameters)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Default RequestMapping&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DefaultRequestMapping&lt;/span&gt;(&lt;span class=&quot;title&quot;&gt;endpoint&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;Endpoint&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;Target&lt;/span&gt;&amp;gt;, &lt;span class=&quot;title&quot;&gt;closure&lt;/span&gt;: &lt;span class=&quot;title&quot;&gt;NSURLRequest&lt;/span&gt; -&amp;gt; &lt;span class=&quot;title&quot;&gt;Void&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; closure(endpoint.urlRequest)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Default Manager&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight swift&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;DefaultAlamofireManager&lt;/span&gt;() -&amp;gt; &lt;span class=&quot;title&quot;&gt;Manager&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; configuration = &lt;span class=&quot;type&quot;&gt;NSURLSessionConfiguration&lt;/span&gt;.defaultSessionConfiguration()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    configuration.&lt;span class=&quot;type&quot;&gt;HTTPAdditionalHeaders&lt;/span&gt; = &lt;span class=&quot;type&quot;&gt;Manager&lt;/span&gt;.defaultHTTPHeaders&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;let&lt;/span&gt; manager = &lt;span class=&quot;type&quot;&gt;Manager&lt;/span&gt;(configuration: configuration)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    manager.startRequestsImmediately = &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; manager&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Reference: &lt;a href=&quot;https://github.com/Moya/Moya/tree/master/docs&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Moya Docs&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;What_is_Moya__uFF1F&quot;&gt;&lt;a href=&quot;#What_is_Moya__uFF1F&quot; class=&quot;headerlink&quot; title=&quot;What is Moya ？&quot;&gt;&lt;/a&gt;What is Moya ？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;So the basic idea of Moya is that we want some network abstraction layer that sufficiently encapsulates actually calling Alamofire directly. It should be simple enough that common things are easy, but comprehensive enough that complicated things are also easy.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Link: &lt;a href=&quot;https://github.com/Moya/Moya&quot;&gt;https://github.com/Moya/Moya&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Feature&quot;&gt;&lt;a href=&quot;#Feature&quot; class=&quot;headerlink&quot; title=&quot;Feature&quot;&gt;&lt;/a&gt;Feature&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Some awesome features of Moya:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Compile-time checking for correct API endpoint accesses.&lt;/li&gt;
&lt;li&gt;Lets you define a clear usage of different endpoints with associated enum values.&lt;/li&gt;
&lt;li&gt;Treats test stubs as first-class citizens so unit testing is super-easy.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://jkyeo.com/tags/iOS/"/>
    
      <category term="Swift" scheme="http://jkyeo.com/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>《Android 源码设计模式解析与实战》学习笔记（一）</title>
    <link href="http://jkyeo.com/2016/05/17/%E3%80%8AAndroid-%E6%BA%90%E7%A0%81%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98%E3%80%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://jkyeo.com/2016/05/17/《Android-源码设计模式解析与实战》学习笔记（一）/</id>
    <published>2016-05-17T10:29:03.000Z</published>
    <updated>2016-06-28T10:43:27.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;u9762_u5411_u5BF9_u8C61&quot;&gt;&lt;a href=&quot;#u9762_u5411_u5BF9_u8C61&quot; class=&quot;headerlink&quot; title=&quot;面向对象&quot;&gt;&lt;/a&gt;面向对象&lt;/h1&gt;&lt;h2 id=&quot;u5355_u4E00_u804C_u8D23_u539F_u5219_-_Single_Responsibility_Principle&quot;&gt;&lt;a href=&quot;#u5355_u4E00_u804C_u8D23_u539F_u5219_-_Single_Responsibility_Principle&quot; class=&quot;headerlink&quot; title=&quot;单一职责原则 - Single Responsibility Principle&quot;&gt;&lt;/a&gt;单一职责原则 - Single Responsibility Principle&lt;/h2&gt;&lt;p&gt;就一个类而言，应该仅有一个引起它变化的原因。简单来说，一个类中应该是一组相关性很高的函数、数据的封装。&lt;/p&gt;
&lt;h2 id=&quot;u5F00_u95ED_u539F_u5219_-_Open_Close_Principle&quot;&gt;&lt;a href=&quot;#u5F00_u95ED_u539F_u5219_-_Open_Close_Principle&quot; class=&quot;headerlink&quot; title=&quot;开闭原则 - Open Close Principle&quot;&gt;&lt;/a&gt;开闭原则 - Open Close Principle&lt;/h2&gt;&lt;p&gt;软件中的对象（类、模块、函数等）应该对扩展是开发的，但是，对于修改是封闭的。&lt;br&gt;开闭原则知道我们：当软件需要变化时，应该尽量通过扩展的方式来实现变化，而不是通过修改已有的代码来实现。&lt;/p&gt;
&lt;h2 id=&quot;u91CC_u6C0F_u66FF_u6362_u539F_u5219_-_Liskov_Substitution_Principle&quot;&gt;&lt;a href=&quot;#u91CC_u6C0F_u66FF_u6362_u539F_u5219_-_Liskov_Substitution_Principle&quot; class=&quot;headerlink&quot; title=&quot;里氏替换原则 - Liskov Substitution Principle&quot;&gt;&lt;/a&gt;里氏替换原则 - Liskov Substitution Principle&lt;/h2&gt;&lt;p&gt;所有引用基类的地方必须能透明地使用其子类的对象。通俗地讲，只要父类能出现的地方子类就可以出现，而且替换为子类也不会产生任何错误或异常。&lt;/p&gt;
&lt;p&gt;面向对象语言的三大特点是继承、封装、多态，里氏替换原则就是依赖于继承、多态这两大特性。&lt;/p&gt;
&lt;h2 id=&quot;u4F9D_u8D56_u5012_u7F6E_u539F_u5219_-_Dependence_Inversion_Principle&quot;&gt;&lt;a href=&quot;#u4F9D_u8D56_u5012_u7F6E_u539F_u5219_-_Dependence_Inversion_Principle&quot; class=&quot;headerlink&quot; title=&quot;依赖倒置原则 - Dependence Inversion Principle&quot;&gt;&lt;/a&gt;依赖倒置原则 - Dependence Inversion Principle&lt;/h2&gt;&lt;p&gt;一种特定的解耦形式，使得高层的模块不依赖于低层次的模块的实现细节目的。&lt;/p&gt;
&lt;p&gt;关键点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1.高层模块不应该依赖底层模块，两者都应该依赖其抽象；&lt;/li&gt;
&lt;li&gt;2.抽象不应该依赖细节；&lt;/li&gt;
&lt;li&gt;3.细节应该依赖抽象。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;u63A5_u53E3_u9694_u79BB_u539F_u5219_-_Interface_Segregation_Principle&quot;&gt;&lt;a href=&quot;#u63A5_u53E3_u9694_u79BB_u539F_u5219_-_Interface_Segregation_Principle&quot; class=&quot;headerlink&quot; title=&quot;接口隔离原则 - Interface Segregation Principle&quot;&gt;&lt;/a&gt;接口隔离原则 - Interface Segregation Principle&lt;/h2&gt;&lt;p&gt;客户端不应该依赖它不需要的接口。另一种定义是：类间的依赖关系应该建立在最小的接口上。&lt;/p&gt;
&lt;h2 id=&quot;u8FEA_u7C73_u7279_u539F_u5219_-_Law_of_Demeter&quot;&gt;&lt;a href=&quot;#u8FEA_u7C73_u7279_u539F_u5219_-_Law_of_Demeter&quot; class=&quot;headerlink&quot; title=&quot;迪米特原则 - Law of Demeter&quot;&gt;&lt;/a&gt;迪米特原则 - Law of Demeter&lt;/h2&gt;&lt;p&gt;也称为最少知识原则（Least Knowledge Principle）&lt;/p&gt;
&lt;p&gt;一个对象应该对其他的对象有最少的了解。&lt;/p&gt;
&lt;p&gt;Only talk to your immediate friends.&lt;/p&gt;
&lt;p&gt;最难的不是完成应用的开发工作，而是后续的升级、维护过程中让应用系统能够拥抱变化。这就意味着在满足需求且不破坏系统稳定性的前提下保持高可扩展性、高内聚、低耦合，在经历了各版本的变更之后依然保持清晰、灵活、稳定的系统架构。&lt;/p&gt;
&lt;h1 id=&quot;u5355_u4F8B_u6A21_u5F0F&quot;&gt;&lt;a href=&quot;#u5355_u4F8B_u6A21_u5F0F&quot; class=&quot;headerlink&quot; title=&quot;单例模式&quot;&gt;&lt;/a&gt;单例模式&lt;/h1&gt;&lt;p&gt;(未完)&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;u9762_u5411_u5BF9_u8C61&quot;&gt;&lt;a href=&quot;#u9762_u5411_u5BF9_u8C61&quot; class=&quot;headerlink&quot; title=&quot;面向对象&quot;&gt;&lt;/a&gt;面向对象&lt;/h1&gt;&lt;h2 id=&quot;u5355_u4E00_u804C_u
    
    </summary>
    
    
      <category term="android" scheme="http://jkyeo.com/tags/android/"/>
    
      <category term="read" scheme="http://jkyeo.com/tags/read/"/>
    
  </entry>
  
  <entry>
    <title>BasicParamsInterceptor - 为 OkHttp 请求添加公共参数</title>
    <link href="http://jkyeo.com/2016/04/18/BasicParamsInterceptor-%E4%B8%BA-OkHttp-%E8%AF%B7%E6%B1%82%E6%B7%BB%E5%8A%A0%E5%85%AC%E5%85%B1%E5%8F%82%E6%95%B0/"/>
    <id>http://jkyeo.com/2016/04/18/BasicParamsInterceptor-为-OkHttp-请求添加公共参数/</id>
    <published>2016-04-18T02:00:51.000Z</published>
    <updated>2016-05-11T02:13:29.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;u80CC_u666F&quot;&gt;&lt;a href=&quot;#u80CC_u666F&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;在 Android Http API 请求开发中经常遇到这样的需求：每一次请求带上一个或者多个固定不变的参数，例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设备唯一标识：device_id = 7a4391e28f309c21&lt;/li&gt;
&lt;li&gt;业务唯一标识：uid = 2231001&lt;/li&gt;
&lt;li&gt;平台类型：platform = android&lt;/li&gt;
&lt;li&gt;客户端版本号：version_code = 6&lt;/li&gt;
&lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些参数是每一次发生请求都需要的，我们姑且称他们为公共参数（或者基础参数）。公共参数一般以 header line、url query 或者 post body(较少) 这些形式插入请求。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;u5B9E_u73B0&quot;&gt;&lt;a href=&quot;#u5B9E_u73B0&quot; class=&quot;headerlink&quot; title=&quot;实现&quot;&gt;&lt;/a&gt;实现&lt;/h2&gt;&lt;p&gt;如果使用 OkHttp 作为 http request client, 这件事情就变得简单多了。OkHttp 提供了强大的拦截器组件 (Interceptor):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Interceptors are a powerful mechanism that can monitor, rewrite, and retry calls. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;也就是说，OkHttp 的拦截器功能之一就是对将要发出的请求进行拦截、改造然后再发出。这正是我们想要的。BasicParamsInterceptor 实现了 okhttp3.Interceptor 接口。&lt;/p&gt;
&lt;p&gt;实现 public Response intercept(Chain chain) throws IOException 方法。使用 Builder 模式，暴露以下接口：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;addParam(String key, String value) &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;post 请求，且 body type 为 x-www-form-urlencoded 时，键值对公共参数插入到 body 参数中，其他情况插入到 url query 参数中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;addParamsMap(Map&lt;string, string=&quot;&quot;&gt; paramsMap)&lt;/string,&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;同上，不过这里用键值对 Map 作为参数批量插入。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;addHeaderParam(String key, String value)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在 header 中插入键值对参数。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;addHeaderParamsMap(Map&lt;string, string=&quot;&quot;&gt; headerParamsMap)&lt;/string,&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在 header 中插入键值对 Map 集合，批量插入。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;addHeaderLine(String headerLine)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在 header 中插入 headerLine 字符串，字符串需要符合 -1 != headerLine.indexOf(“:”) 的规则，即可以解析成键值对。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;addHeaderLinesList(List&lt;string&gt; headerLinesList)&lt;/string&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;同上，headerLineList: List&lt;string&gt; 为参数，批量插入 headerLine。&lt;/string&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;addQueryParam(String key, String value)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;插入键值对参数到 url query 中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;addQueryParamsMap(Map&lt;string, string=&quot;&quot;&gt; queryParamsMap)&lt;/string,&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;插入键值对参数 map 到 url query 中，批量插入。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;u793A_u4F8B&quot;&gt;&lt;a href=&quot;#u793A_u4F8B&quot; class=&quot;headerlink&quot; title=&quot;示例&quot;&gt;&lt;/a&gt;示例&lt;/h2&gt;&lt;p&gt;使用 Buider 模式创建 Interceptor 对象，然后调用 OkHttp 的 addInterceptor(Interceptor i) 方法将 interceptor 对象添加至 client 中：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;BasicParamsInterceptor basicParamsInterceptor =&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OkPublicParamsInterceptor.Builder()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .addHeaderParam(&lt;span class=&quot;string&quot;&gt;&quot;device_id&quot;&lt;/span&gt;, DeviceUtils.getDeviceId())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .addParam(&lt;span class=&quot;string&quot;&gt;&quot;uid&quot;&lt;/span&gt;, UserModel.getInstance().getUid())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .addQueryParam(&lt;span class=&quot;string&quot;&gt;&quot;api_version&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;1.1&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .build();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;OkHttpClient client = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OkHttpClient.Builder()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        .addInterceptor(basicParamsInterceptor)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        .build();&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;TODO&quot;&gt;&lt;a href=&quot;#TODO&quot; class=&quot;headerlink&quot; title=&quot;TODO&quot;&gt;&lt;/a&gt;TODO&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;[ ] 自动时间戳公共参数的支持&lt;/li&gt;
&lt;li&gt;[ ] 动态参数的支持（例如登录后插入服务器返回的 uid）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;u6E90_u7801&quot;&gt;&lt;a href=&quot;#u6E90_u7801&quot; class=&quot;headerlink&quot; title=&quot;源码&quot;&gt;&lt;/a&gt;源码&lt;/h2&gt;&lt;p&gt;源码与引用：&lt;a href=&quot;https://github.com/jkyeo/okhttp-basicparamsinterceptor&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/jkyeo/okhttp-basicparamsinterceptor&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u80CC_u666F&quot;&gt;&lt;a href=&quot;#u80CC_u666F&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;在 Android Http API 请求开发中经常遇到这样的需求：每一次请求带上一个或者多个固定不变的参数，例如：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设备唯一标识：device_id = 7a4391e28f309c21&lt;/li&gt;
&lt;li&gt;业务唯一标识：uid = 2231001&lt;/li&gt;
&lt;li&gt;平台类型：platform = android&lt;/li&gt;
&lt;li&gt;客户端版本号：version_code = 6&lt;/li&gt;
&lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些参数是每一次发生请求都需要的，我们姑且称他们为公共参数（或者基础参数）。公共参数一般以 header line、url query 或者 post body(较少) 这些形式插入请求。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://jkyeo.com/tags/Android/"/>
    
      <category term="OkHttp" scheme="http://jkyeo.com/tags/OkHttp/"/>
    
  </entry>
  
  <entry>
    <title>可能是最「轻」的 EventBus - 利用 RxJava 打造 EventBus</title>
    <link href="http://jkyeo.com/2016/03/01/%E5%8F%AF%E8%83%BD%E6%98%AF%E6%9C%80%E3%80%8C%E8%BD%BB%E3%80%8D%E7%9A%84-EventBus-%E5%88%A9%E7%94%A8-RxJava-%E6%89%93%E9%80%A0-EventBus/"/>
    <id>http://jkyeo.com/2016/03/01/可能是最「轻」的-EventBus-利用-RxJava-打造-EventBus/</id>
    <published>2016-03-01T13:49:26.000Z</published>
    <updated>2016-05-11T02:13:29.000Z</updated>
    
    <content type="html">&lt;p&gt;站在巨人（RxJava）的肩膀上封装了一个简单的 EventBus。 很轻很小，使用也很简单。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;单例模式；&lt;br&gt;按 tag: String 索引；&lt;br&gt;发送/接受 ? extends java.lang.Object；&lt;br&gt;支持在 IO 线程或 UI 线程中执行观察者回调；&lt;/p&gt;
&lt;/blockquote&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;上代码：RxBus.java&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * Created by jk.yeo on 16/3/1 17:47.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * 基于 RxJava 简单的 EventBus&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RxBus&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;volatile&lt;/span&gt; RxBus mDefaultInstance;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RxBus&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; RxBus &lt;span class=&quot;title&quot;&gt;getDefault&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mDefaultInstance == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt; (RxBus.class) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (mDefaultInstance == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    mDefaultInstance = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RxBus();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; mDefaultInstance;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    PublishSubject&amp;lt;EventObject&amp;gt; publishSubject = PublishSubject.create();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Subject&amp;lt;EventObject, EventObject&amp;gt; _bus = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SerializedSubject&amp;lt;&amp;gt;(publishSubject);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String tag, Object object)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        EventObject eventObject = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; EventObject(tag, object);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        _bus.onNext(eventObject);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReceiveOnUiThread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;OnReceive&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String tag, Object object)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ReceiveOnIOThread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;OnReceive&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String tag, Object object)&lt;/span&gt;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;registerOnUiThread&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; ReceiveOnUiThread receiveOnUiThread)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        _bus.observeOn(AndroidSchedulers.mainThread())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .subscribe(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Action1&amp;lt;EventObject&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(EventObject eventObject)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        receiveOnUiThread.OnReceive(eventObject.getTag(), eventObject.getObject());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;registerOnIOThread&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; ReceiveOnIOThread receiveOnIOThread)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        _bus.observeOn(Schedulers.io())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                .subscribe(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Action1&amp;lt;EventObject&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(EventObject eventObject)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        receiveOnIOThread.OnReceive(eventObject.getTag(), eventObject.getObject());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;EventObject&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Object&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String tag;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Object object;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;EventObject&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String tag, Object object)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.tag = tag;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.object = object;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getTag&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; tag;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;title&quot;&gt;getObject&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; object;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用也很简单：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;RxBus.getDefault().registerOnIOThread(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RxBus.ReceiveOnIOThread() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;OnReceive&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String tag, Object object)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tag.equals(&lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// do something on IO thread.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RxBus.getDefault().registerOnUiThread(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RxBus.ReceiveOnUiThread() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;OnReceive&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String tag, Object object)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tag.equals(&lt;span class=&quot;string&quot;&gt;&quot;2&quot;&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;comment&quot;&gt;// do something on Ui thread&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;							&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; RxBus.getDefault().send(&lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;tag = 1&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; RxBus.getDefault().send(&lt;span class=&quot;string&quot;&gt;&quot;2&quot;&lt;/span&gt;, UserModel.getInstance());&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;参考：&lt;a href=&quot;http://hanhailong.com/2015/10/09/RxBus—通过RxJava来替换EventBus/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;RxBus—通过RxJava来替换EventBus&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;站在巨人（RxJava）的肩膀上封装了一个简单的 EventBus。 很轻很小，使用也很简单。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;单例模式；&lt;br&gt;按 tag: String 索引；&lt;br&gt;发送/接受 ? extends java.lang.Object；&lt;br&gt;支持在 IO 线程或 UI 线程中执行观察者回调；&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="rxjava" scheme="http://jkyeo.com/tags/rxjava/"/>
    
      <category term="android" scheme="http://jkyeo.com/tags/android/"/>
    
      <category term="eventbus" scheme="http://jkyeo.com/tags/eventbus/"/>
    
  </entry>
  
  <entry>
    <title>Retrofit + RxJava 业务状态重定向及分离</title>
    <link href="http://jkyeo.com/2016/03/01/Retrofit-RxJava-%E4%B8%9A%E5%8A%A1%E7%8A%B6%E6%80%81%E9%87%8D%E5%AE%9A%E5%90%91%E5%8F%8A%E5%88%86%E7%A6%BB/"/>
    <id>http://jkyeo.com/2016/03/01/Retrofit-RxJava-业务状态重定向及分离/</id>
    <published>2016-03-01T02:11:27.000Z</published>
    <updated>2016-05-11T02:13:29.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;u95EE_u9898&quot;&gt;&lt;a href=&quot;#u95EE_u9898&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h2&gt;&lt;p&gt;本文主要介绍了在 Retrofit + ReJava 环境下更优雅的解决了以下两个问题：&lt;/p&gt;
&lt;div class=&quot;tip&quot;&gt;&lt;br&gt;    &lt;p&gt;1. 将接口业务上的失败重定向到 onError(Throwable e) 输出；&lt;/p&gt;&lt;br&gt;    &lt;p&gt;2. 业务成功时分离出 data 数据由 onNext(T t) 输出；&lt;/p&gt;&lt;br&gt;&lt;/div&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;u573A_u666F&quot;&gt;&lt;a href=&quot;#u573A_u666F&quot; class=&quot;headerlink&quot; title=&quot;场景&quot;&gt;&lt;/a&gt;场景&lt;/h2&gt;&lt;p&gt;一般来说，一个友好的接口返回 json 应该是这样的：&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;code&quot;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;codeMsg&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;查询成功!&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;data&quot;&lt;/span&gt;:&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;&quot;city&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;北京&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;&quot;temperature&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;8℃~20℃&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;&quot;weather&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;晴转霾&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;或者这样的：&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;code&quot;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;codeMsg&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;查询成功!&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;data&quot;&lt;/span&gt;:[&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;city&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;北京&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;temperature&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;8℃~20℃&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;weather&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;晴转霾&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;city&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;南京&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;temperature&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;12℃~21℃&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;&quot;weather&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;晴&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果约定好，code == 2xx，表示业务成功。其他表示业务失败，codeMsg 更详细地描述业务状态信息。例如：&lt;/p&gt;
&lt;figure class=&quot;highlight json&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;code&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;400&quot;&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;&quot;codeMsg&quot;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&quot;未知的城市&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;u5B9E_u73B0&quot;&gt;&lt;a href=&quot;#u5B9E_u73B0&quot; class=&quot;headerlink&quot; title=&quot;实现&quot;&gt;&lt;/a&gt;实现&lt;/h2&gt;&lt;p&gt;要知道，利用 Retrofit + Gson (或者其他 Converter ) 可以将返回的 Json 的转换为对象的，那么可以定义以下返回通用类 Model ：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * CommonResponse - 通用类&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * 泛型 T 可以为 List&amp;lt;object&amp;gt; , 也可以是 Object , 也可以为空。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;CommonResponse&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; code;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String codeMsg;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; T data;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getCode&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; code;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getCodeMsg&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; codeMsg;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; T &lt;span class=&quot;title&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * 根据 code 码判断业务状态&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     * code == 2xx，表示业务成功。其他表示业务失败，codeMsg 进一步描述业务状态。&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;isSuccess&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; code / &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt; == &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;为了解决上面提出的两个问题，这里可以使用 RxJava 中的 lift() 来自定义操作：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * 这里为了示例，简化了Retrofit Service、Api 创建的过程。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;JKApi mApi = JKService.createJKService();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mApi.getWeatherForCity(&lt;span class=&quot;string&quot;&gt;&quot;北京&quot;&lt;/span&gt;).lift(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Observable.Operator&amp;lt;T, CommonResponse&amp;lt;T&amp;gt;&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Subscriber&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; CommonResponse&amp;lt;T&amp;gt;&amp;gt; call(&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Subscriber&amp;lt;? &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; subscriber) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Subscriber&amp;lt;CommonResponse&amp;lt;T&amp;gt;&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCompleted&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        subscriber.onCompleted();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onError&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Throwable e)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        subscriber.onError(e);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(CommonResponse&amp;lt;T&amp;gt; tCommonResponse)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tCommonResponse.isSuccess())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            subscriber.onNext(tCommonResponse.getData());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            subscriber.onError(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Throwable(tCommonResponse.getCodeMsg()));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面的 lift() 操作想要对每一个符合这样标准的接口都通用，并且顺便对线程指定进行封装。可以 implements Observable.Transformer&amp;lt;?, ?&amp;gt;:&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;RedirectResponseTransformer&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Observable&lt;/span&gt;.&lt;span class=&quot;title&quot;&gt;Transformer&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;CommonResponse&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt;, &lt;span class=&quot;title&quot;&gt;T&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Observable&amp;lt;T&amp;gt; &lt;span class=&quot;title&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        Observable&amp;lt;CommonResponse&amp;lt;T&amp;gt;&amp;gt; CommonResponseObservable) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; CommonResponseObservable.subscribeOn(Schedulers.io())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                       .observeOn(AndroidSchedulers.mainThread())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                       .lift(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Observable.Operator&amp;lt;T, CommonResponse&amp;lt;T&amp;gt;&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Subscriber&amp;lt;?&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; CommonResponse&amp;lt;T&amp;gt;&amp;gt; call(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Subscriber&amp;lt;?&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; T&amp;gt; subscriber) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Subscriber&amp;lt;CommonResponse&amp;lt;T&amp;gt;&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCompleted&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                subscriber.onCompleted();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onError&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Throwable e)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                subscriber.onError(e);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                CommonResponse&amp;lt;T&amp;gt; tCommonResponse) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (tCommonResponse.isSuccess()) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                    subscriber.onNext(tCommonResponse.getData());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                    subscriber.onError(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Throwable(&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                            tCommonResponse.getCodeMsg()));&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;最后我们使用 Observable.compose(Transformer transformer) 方法将以上的封装加入到 Rx-Chain 中去：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; * 这里为了示例，简化了Retrofit Service、Api 创建的过程。 &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;JKApi mApi = JKService.createJKService();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;mApi.getWeatherForCity(&lt;span class=&quot;string&quot;&gt;&quot;北京&quot;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.compose(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; RedirectResponseTransformer&amp;lt;WeatherModel&amp;gt;())&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	.subscribe(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Subscriber&amp;lt;WeatherModel&amp;gt;() &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCompleted&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onError&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Throwable e)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        showShortToast(e.toString());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(WeatherModel weatherModel)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;span class=&quot;comment&quot;&gt;// do something like refresh ui&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;到这里，针对上文提出的两个问题已经做了封装。其实利用 RxJava 强大的运算符还可以做很多封装。例如：针对特定异常显示Toast、onComplete() 回调中 dismiss loadingDialog 等。以后将不断完善。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;u95EE_u9898&quot;&gt;&lt;a href=&quot;#u95EE_u9898&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h2&gt;&lt;p&gt;本文主要介绍了在 Retrofit + ReJava 环境下更优雅的解决了以下两个问题：&lt;/p&gt;
&lt;div class=&quot;tip&quot;&gt;&lt;br&gt;    &lt;p&gt;1. 将接口业务上的失败重定向到 onError(Throwable e) 输出；&lt;/p&gt;&lt;br&gt;    &lt;p&gt;2. 业务成功时分离出 data 数据由 onNext(T t) 输出；&lt;/p&gt;&lt;br&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="rxjava" scheme="http://jkyeo.com/tags/rxjava/"/>
    
      <category term="retrofit" scheme="http://jkyeo.com/tags/retrofit/"/>
    
      <category term="android" scheme="http://jkyeo.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>新公司入职我折腾「科学上网」的那些事</title>
    <link href="http://jkyeo.com/2016/01/28/%E6%96%B0%E5%85%AC%E5%8F%B8%E5%85%A5%E8%81%8C%E6%88%91%E6%8A%98%E8%85%BE%E3%80%8C%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E3%80%8D%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B/"/>
    <id>http://jkyeo.com/2016/01/28/新公司入职我折腾「科学上网」的那些事/</id>
    <published>2016-01-28T04:15:31.000Z</published>
    <updated>2016-05-11T02:13:29.000Z</updated>
    
    <content type="html">&lt;p&gt;年关将至，我裸辞了。其中原由就不细说了。还好有公司愿意收留我。&lt;br&gt;入职第一天感觉一切都是美好的。直到行政给我一张小纸条：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;工号: xxxx&lt;br&gt;IP: 192.168.25.x&lt;br&gt;子网掩码: 255.255.255.x&lt;br&gt;网关: 192.168.25.1&lt;br&gt;DNS: x.x.x.x&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;对！固定IP。看来自由上网的可能性不大了。&lt;br&gt;吓得我赶紧测试一下，果然连接自己搭建的 shadowsocks 服务时好时坏，丢包严重。ssh vps 也一直 timeout。问题必须解决啊！&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;shadowsocks__u534F_u8BAE_u4E2D_u7EE7&quot;&gt;&lt;a href=&quot;#shadowsocks__u534F_u8BAE_u4E2D_u7EE7&quot; class=&quot;headerlink&quot; title=&quot;shadowsocks 协议中继&quot;&gt;&lt;/a&gt;shadowsocks 协议中继&lt;/h3&gt;&lt;p&gt;先说一下我的 vps 的情况。&lt;a href=&quot;https://m.do.co/c/208b7803c265&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;DigitalOcean&lt;/a&gt; 的主机，San Francisco 1 节点，CentOS7.1 x64 OS，装了锐速（效果真的很赞，可惜官方已经不再提供注册、安装服务了）。主机上挂了 blog、shadowsocks、vpn 等服务。日常自己使用足够了。&lt;/p&gt;
&lt;p&gt;shadowsocks 是支持中继的，于是参考了 &lt;a href=&quot;http://www.jianshu.com/users/ee0c82396a94/latest_articles&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;@代码家&lt;/a&gt; 的这篇文章 &lt;a href=&quot;http://www.jianshu.com/p/475182d8c503&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;《提速 Shadowsocks》&lt;/a&gt; ，使用 &lt;a href=&quot;https://vnet.link/?rc=34766&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;VnetLink&lt;/a&gt; 做了中继。具体步骤引用自代码家的文章：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;第一步：用我的 &lt;a href=&quot;https://vnet.link/?rc=34766&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;邀请码&lt;/a&gt; 注册，咱们一人新增 1GB 流量。&lt;/li&gt;
&lt;li&gt;第二步：在设置选项里勾上 vxTrans，其他可以不勾。&lt;/li&gt;
&lt;li&gt;第三步：在 &lt;a href=&quot;https://vnet.link/service/vxtrans/index&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt; 新建一个连接，目的地址填你的 SS 服务器地址，目的端口填你的 SS 服务端口，入口地址根据自己宽带运营商实际情况选择就好了，我这里是中国电信，所以选择了「China Telecom」，名称随便起。&lt;/li&gt;
&lt;li&gt;第三步：点击建立新连接，你会看到一个 新的入口地址 和 新的入口端口 。&lt;/li&gt;
&lt;li&gt;第四步：打开你平时连接 SS 的客户端，把 服务器地址 改成 新的入口地址 ，把服务器端口，改成 新的入口端口，密码不用变。然后连接就好啦！&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;测试一下，恩~ 果然速度飞起！如果速度不理想在第三步可以尝试选择不同的入口地址试试。&lt;/p&gt;
&lt;h2 id=&quot;u5728_u8DEF_u7531_u5668_u67B6_u8BBE_VPN_Server&quot;&gt;&lt;a href=&quot;#u5728_u8DEF_u7531_u5668_u67B6_u8BBE_VPN_Server&quot; class=&quot;headerlink&quot; title=&quot;在路由器架设 VPN Server&quot;&gt;&lt;/a&gt;在路由器架设 VPN Server&lt;/h2&gt;&lt;p&gt;那么问题来了，在办公室无法 ssh 连接到主机怎么办？不想被网管监控流量怎么办？不幸的是 ssh 是不支持中继的。不能用上面的方法了。只能考虑 VPN 了。难道再去阿里云开个主机？不行，这(qi)不(shi)优(mei)雅(qian)！&lt;/p&gt;
&lt;p&gt;想到家里和公司一样，也是中国电信的宽带，直接把 VPN Server 家里就好了，反正白天在办公室的时间家里的宽带也是闲置。在公司 ping 了一下家里路由器，速度实在很意外啊！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;64 bytes from 222.94.163.22: icmp_seq=0 ttl=59 time=6.646 ms&lt;br&gt;64 bytes from 222.94.163.22: icmp_seq=1 ttl=59 time=4.452 ms&lt;br&gt;64 bytes from 222.94.163.22: icmp_seq=2 ttl=59 time=3.511 ms&lt;br&gt;64 bytes from 222.94.163.22: icmp_seq=3 ttl=59 time=3.659 ms&lt;br&gt;64 bytes from 222.94.163.22: icmp_seq=4 ttl=59 time=3.507 ms&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;VPN Server 不至于家里开着 PC 了。一台智能路由就搞定，需要符合以下条件：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;路由可以刷 openWrt 类似固件或者智能路由可以 root；&lt;/li&gt;
&lt;li&gt;家里宽带有外网 IP，没有的话，起码可以做端口映射；&lt;/li&gt;
&lt;li&gt;有自己的域名，这样可以通过 CNAME 实时解析家里宽带的 IP；&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我使用的是极路由1S，连 root 都不需要，只要安装下面两个插件：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xqi9q.com1.z0.glb.clouddn.com/FmSJ9s-oPt2TgtbM1oOimIASqSsN&quot; alt=&quot;B90CE51C-D046-4478-95D2-27E3DECEE54D&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;「VPN 服务器」当然是在 hiwifi 上搭建 VPN Server 使用的，很简单，设置用户名、密码，选择服务类型，点击「运行」即可。&lt;/li&gt;
&lt;li&gt;「动态域名」是 hiwifi 官方的一个插件，这个插件在很短的 TTL 时间里将路由器的 WAN 口 IP 地址执行 jios.com 的一个二级域名。这里我在自己的域名里做了 CNAME 指向它完成了解析。让然也可以直接使用这个 jios.com 的二级域名。可以替代的还有很多，例如「DNSPOD 动态域名」、「花生壳动态域名」等。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;回到办公室，连接 VPN，速度依然飞起！ssh 的问题也随之解决了。&lt;/p&gt;
&lt;h2 id=&quot;VPN_+_shadowsocks-pac&quot;&gt;&lt;a href=&quot;#VPN_+_shadowsocks-pac&quot; class=&quot;headerlink&quot; title=&quot;VPN + shadowsocks-pac&quot;&gt;&lt;/a&gt;VPN + shadowsocks-pac&lt;/h2&gt;&lt;p&gt;那么问题又来了，连接 VPN 后，shadowsocks pac 代理失效了。&lt;br&gt;这是因为 Mac shadowsocksX 客户端仅对 Wi-Fi、USB 以太网和 Thunderbolt 以太网等连接设置「自动代理配置」。这里只要手动设置一下 VPN 的「自动代理配置」即可：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;系统偏好设置 -&amp;gt; 网络 -&amp;gt; VPN -&amp;gt; 高级… -&amp;gt; 代理 -&amp;gt; 勾选「自动代理配置」，并在 URL 中填写你的 ShadowsocksX 的 pac URL（例如我的 &lt;code&gt;http://127.0.0.1:8090/proxy.pac&lt;/code&gt;）。其他平台、客户端设置类似。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;u4E0D_u5B8C_u7F8E&quot;&gt;&lt;a href=&quot;#u4E0D_u5B8C_u7F8E&quot; class=&quot;headerlink&quot; title=&quot;不完美&quot;&gt;&lt;/a&gt;不完美&lt;/h2&gt;&lt;p&gt;这个方案初步解决了办公室「科学上网」的需求。但是仍有不完美的地方。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;需付费在 VnetLink 中转，考虑后期在路由器搭建 haproxy 中转 shadowsocks&lt;/li&gt;
&lt;li&gt;连接家里 VPN 后仍需配置本地 shadowsocks-pac 代理，考虑在路由器上配置 shadowsocks 客户端，Mac、iPhone 等设备设置自动发现 VPN Server 上的 PAC 代理。这样就实现了。无论在哪里、什么设备连接家里 VPN 都可以 FQ。&lt;/li&gt;
&lt;li&gt;这样一来路由器 128M 的 RAM 怕是不够用了，剁手…或者树莓派。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&quot;u53C2_u8003_u6587_u7AE0&quot;&gt;&lt;a href=&quot;#u53C2_u8003_u6587_u7AE0&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/475182d8c503&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;提速 Shadowsocks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://luolei.org/hiwifi-shadowsocks/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;极路由Shadowsocks家庭无痛翻墙实践&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;年关将至，我裸辞了。其中原由就不细说了。还好有公司愿意收留我。&lt;br&gt;入职第一天感觉一切都是美好的。直到行政给我一张小纸条：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;工号: xxxx&lt;br&gt;IP: 192.168.25.x&lt;br&gt;子网掩码: 255.255.255.x&lt;br&gt;网关: 192.168.25.1&lt;br&gt;DNS: x.x.x.x&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;对！固定IP。看来自由上网的可能性不大了。&lt;br&gt;吓得我赶紧测试一下，果然连接自己搭建的 shadowsocks 服务时好时坏，丢包严重。ssh vps 也一直 timeout。问题必须解决啊！&lt;/p&gt;
    
    </summary>
    
    
      <category term="shadowsocks" scheme="http://jkyeo.com/tags/shadowsocks/"/>
    
      <category term="vps" scheme="http://jkyeo.com/tags/vps/"/>
    
      <category term="科学上网" scheme="http://jkyeo.com/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
  </entry>
  
</feed>
