<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 学习 Swift Moya（一） · 一路小跑</title><meta name="description" content="学习 Swift Moya（一） - jk.yeo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="https://github.com/jkyeo" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/Link/" target="_self" class="nav-list-link">LINK</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">学习 Swift Moya（一）</h1><div class="post-info">Jun 28, 2016</div><div class="post-content"><h2 id="What_is_Moya__uFF1F"><a href="#What_is_Moya__uFF1F" class="headerlink" title="What is Moya ？"></a>What is Moya ？</h2><blockquote>
<p>So the basic idea of Moya is that we want some network abstraction layer that sufficiently encapsulates actually calling Alamofire directly. It should be simple enough that common things are easy, but comprehensive enough that complicated things are also easy.</p>
</blockquote>
<p>Link: <a href="https://github.com/Moya/Moya" target="_blank" rel="external">https://github.com/Moya/Moya</a></p>
<h2 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h2><blockquote>
<p>Some awesome features of Moya:</p>
<ul>
<li>Compile-time checking for correct API endpoint accesses.</li>
<li>Lets you define a clear usage of different endpoints with associated enum values.</li>
<li>Treats test stubs as first-class citizens so unit testing is super-easy.</li>
</ul>
</blockquote>
<a id="more"></a>
<h2 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h2><p><img src="http://7xqi9q.com1.z0.glb.clouddn.com/2016-06-28_Moya.png" alt="2016-06-28_Moya.png"></p>
<h2 id="Default_Configure"><a href="#Default_Configure" class="headerlink" title="Default Configure"></a>Default Configure</h2><ul>
<li><strong>MoyaProvider Default init</strong></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">init</span>(endpointClosure: <span class="type">EndpointClosure</span> = <span class="type">MoyaProvider</span>.<span class="type">DefaultEndpointMapping</span>,</div><div class="line">    requestClosure: <span class="type">RequestClosure</span> = <span class="type">MoyaProvider</span>.<span class="type">DefaultRequestMapping</span>,</div><div class="line">    stubClosure: <span class="type">StubClosure</span> = <span class="type">MoyaProvider</span>.<span class="type">NeverStub</span>,</div><div class="line">    manager: <span class="type">Manager</span> = <span class="type">MoyaProvider</span>&lt;<span class="type">Target</span>&gt;.<span class="type">DefaultAlamofireManager</span>(),</div><div class="line">    plugins: [<span class="type">PluginType</span>] = []) &#123;</div><div class="line">		</div><div class="line">        <span class="keyword">self</span>.endpointClosure = endpointClosure</div><div class="line">        <span class="keyword">self</span>.requestClosure = requestClosure</div><div class="line">        <span class="keyword">self</span>.stubClosure = stubClosure</div><div class="line">        <span class="keyword">self</span>.manager = manager</div><div class="line">        <span class="keyword">self</span>.plugins = plugins</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>Default EndpointClosure</strong></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">DefaultEndpointMapping</span>(<span class="title">target</span>: <span class="title">Target</span>) -&gt; <span class="title">Endpoint</span>&lt;<span class="title">Target</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">let</span> url = target.baseURL.<span class="type">URLByAppendingPathComponent</span>(target.path).absoluteString</div><div class="line">    <span class="keyword">return</span> <span class="type">Endpoint</span>(<span class="type">URL</span>: url, sampleResponseClosure: &#123;.<span class="type">NetworkResponse</span>(<span class="number">200</span>, target.sampleData)&#125;, method: target.method, parameters: target.parameters)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>Default RequestMapping</strong></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">DefaultRequestMapping</span>(<span class="title">endpoint</span>: <span class="title">Endpoint</span>&lt;<span class="title">Target</span>&gt;, <span class="title">closure</span>: <span class="title">NSURLRequest</span> -&gt; <span class="title">Void</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> closure(endpoint.urlRequest)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>Default Manager</strong></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">DefaultAlamofireManager</span>() -&gt; <span class="title">Manager</span> </span>&#123;</div><div class="line">    <span class="keyword">let</span> configuration = <span class="type">NSURLSessionConfiguration</span>.defaultSessionConfiguration()</div><div class="line">    configuration.<span class="type">HTTPAdditionalHeaders</span> = <span class="type">Manager</span>.defaultHTTPHeaders</div><div class="line"></div><div class="line">    <span class="keyword">let</span> manager = <span class="type">Manager</span>(configuration: configuration)</div><div class="line">    manager.startRequestsImmediately = <span class="literal">false</span></div><div class="line">    <span class="keyword">return</span> manager</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Reference: <a href="https://github.com/Moya/Moya/tree/master/docs" target="_blank" rel="external">Moya Docs</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/06/29/学习-Swift-Moya（二）-Moya-SwiftyJSON-RxSwift/" class="prev">PREV</a><a href="/2016/05/17/《Android-源码设计模式解析与实战》学习笔记（一）/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'jkyeo';
var disqus_identifier = '2016/06/28/学习-Swift-Moya（一）/';
var disqus_title = '学习 Swift Moya（一）';
var disqus_url = 'http://jkyeo.com/2016/06/28/学习-Swift-Moya（一）/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//jkyeo.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 <a href="http://jkyeo.com">jk.yeo</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-64117634-2",'auto');ga('send','pageview');</script></body></html>